<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MassWateR">
<title>MassWateR data input and checks • MassWateR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MassWateR data input and checks">
<meta property="og:description" content="MassWateR">
<meta property="og:image" content="https://massbays-tech.github.io/MassWateR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MassWateR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9002</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/datainput.html">MassWateR data input and checks</a>
    <a class="dropdown-item" href="../articles/qcoverview.html">MassWateR quality control functions</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/massbays-tech/MassWateR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="datainput_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>MassWateR data input and checks</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/massbays-tech/MassWateR/blob/HEAD/vignettes/datainput.Rmd" class="external-link"><code>vignettes/datainput.Rmd</code></a></small>
      <div class="d-none name"><code>datainput.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The MassWateR R package is developed to work with surface water monitoring data collected by watershed associations and citizen science groups in Massachusetts. The package is created in collaboration with the <a href="https://www.mass.gov/orgs/massachusetts-bays-national-estuary-partnership" class="external-link">Massachusetts Bays National Estuary Partnership</a> with funding from an EPA Exchange Network Grant.</p>
<p>The objective of the package is to automate and facilitate quality control and exploratory analysis of data intended for upload to the EPA <a href="https://www.epa.gov/waterdata/water-quality-data" class="external-link">Water Quality Exchange</a> (WQX). The functions provide a streamlined and repeatable means of 1) screening data for quality control, 2) interpreting data, and 3) creating graphics for analysis and reports to stakeholders. Miscellaneous formatting tools are also available to facilitate data upload to WQZ. The functions are organized around these topics, shown below.</p>
<div class="figure" style="text-align: center">
<img src="workflow.PNG" alt="Functions in MassWateR are organized around these topics." width="100%"><p class="caption">
Functions in MassWateR are organized around these topics.
</p>
</div>
<p>Three types of data can be used with the package. All types should be provided to make best use of the functions, although not all are required.</p>
<ol style="list-style-type: decimal">
<li>Water quality <strong>results</strong> organized by sample location and date.</li>
<li>Summary of data quality objectives that describe quality control <strong>accuracy</strong> and <strong>completeness</strong> measures for data in the results file.</li>
<li>An optional file of <strong>site metadata</strong>, including location names, latitude, longitude, and additional grouping factors for sites.</li>
</ol>
<p>The input data should follow standard formats for the WQX network. Example files, described below, are provided with the package to demonstrate the appropriate formats.</p>
</div>
<div class="section level2">
<h2 id="installation-and-example-data-files">Installation and example data files<a class="anchor" aria-label="anchor" href="#installation-and-example-data-files"></a>
</h2>
<p>Install the package as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Enable universe(s) by massbays-tech</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
  massbaystech <span class="op">=</span> <span class="st">'https://massbays-tech.r-universe.dev'</span>,
  CRAN <span class="op">=</span> <span class="st">'https://cloud.r-project.org'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Install the package</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'MassWateR'</span><span class="op">)</span></code></pre></div>
<p>Load the package in an R session after installation:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/massbays-tech/MassWateR" class="external-link">MassWateR</a></span><span class="op">)</span></code></pre></div>
<p>The example files for the package can be viewed by navigating to their location in the package installation. These are available as Excel files. Running the code below will show where the files are located.</p>
<p>The surface water quality results files:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/ExampleResults_final.xlsx'</span>, package <span class="op">=</span> <span class="st">'MassWateR'</span><span class="op">)</span></code></pre></div>
<p>The data quality objectives file for accuracy:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/ExampleDQOAccuracy_final.xlsx'</span>, package <span class="op">=</span> <span class="st">'MassWateR'</span><span class="op">)</span></code></pre></div>
<p>The data quality objectives file for completeness:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/ExampleDQOCompleteness_final.xlsx'</span>, package <span class="op">=</span> <span class="st">'MassWateR'</span><span class="op">)</span></code></pre></div>
<p>The site metadata file:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/ExampleSites_final.xlsx'</span>, package <span class="op">=</span> <span class="st">'MassWateR'</span><span class="op">)</span></code></pre></div>
<p>The example files are provided to demonstrate how the functions in MassWateR are used. In practice, alternative data files that follow the same format as the examples can be used with the functions. There are several checks included in the data import functions to ensure the files are formatted correctly for downstream use. If any of the checks fail, an error message will be returned that prompts the necessary changes that must be made to the Excel file before the data can be used. The checks can be suppressed by setting <code>runchk = FALSE</code> in the import functions. These checks are described in the next section.</p>
</div>
<div class="section level2">
<h2 id="data-import-and-checks">Data import and checks<a class="anchor" aria-label="anchor" href="#data-import-and-checks"></a>
</h2>
<p>The MassWateR package is developed for quality control and exploratory analysis of surface water quality data. Before these analyses can occur, the data must be formatted correctly. This section describes how to import data and the expectations that are checked automatically by the functions.</p>
<div class="section level3">
<h3 id="surface-water-quality-results">Surface water quality results<a class="anchor" aria-label="anchor" href="#surface-water-quality-results"></a>
</h3>
<p>First, the surface water quality results can be imported with the <code><a href="../reference/read_results.html">read_results()</a></code> function. This is designed to import an Excel file external to R, run checks on the data, and provide some minor formatting for downstream quality control or exploratory analysis. In this example, the system file <code>ExampleResults_final.xlsx</code> is imported. In practice, the <code>pth</code> argument will point to an alternative external file in the WQX format. Note that <code>runchk = TRUE</code> is set to run the checks on data import. This is the default setting and it is not necessary to explicitly set this argument on import.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">respth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/ExampleResults_final.xlsx'</span>, package <span class="op">=</span> <span class="st">'MassWateR'</span><span class="op">)</span>
<span class="va">resdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_results.html">read_results</a></span><span class="op">(</span><span class="va">respth</span>, runchk <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Running checks on results data...</span>
<span class="co">#&gt; Called from: check_results(resdat)</span>
<span class="co">#&gt; debug: msg &lt;- "\tChecking column names..."</span>
<span class="co">#&gt; debug: nms &lt;- names(resdat)</span>
<span class="co">#&gt; debug: chk &lt;- nms %in% colnms</span>
<span class="co">#&gt; debug: if (any(!chk)) {</span>
<span class="co">#&gt;     tochk &lt;- nms[!chk]</span>
<span class="co">#&gt;     stop(msg, "\n\tPlease correct the column names or remove: ", </span>
<span class="co">#&gt;         paste(tochk, collapse = ", "), call. = FALSE)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug: message(paste(msg, "OK"))</span>
<span class="co">#&gt;  Checking column names... OK</span>
<span class="co">#&gt; debug: msg &lt;- "\tChecking all required columns are present..."</span>
<span class="co">#&gt; debug: nms &lt;- names(resdat)</span>
<span class="co">#&gt; debug: chk &lt;- colnms[-14] %in% nms</span>
<span class="co">#&gt; debug: if (any(!chk)) {</span>
<span class="co">#&gt;     tochk &lt;- colnms[!chk]</span>
<span class="co">#&gt;     stop(msg, "\n\tMissing the following columns: ", paste(tochk, </span>
<span class="co">#&gt;         collapse = ", "), call. = FALSE)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug: message(paste(msg, "OK"))</span>
<span class="co">#&gt;  Checking all required columns are present... OK</span>
<span class="co">#&gt; debug: msg &lt;- "\tChecking valid Activity Types..."</span>
<span class="co">#&gt; debug: typ &lt;- resdat$`Activity Type`</span>
<span class="co">#&gt; debug: chk &lt;- typ %in% acttyp</span>
<span class="co">#&gt; debug: if (any(!chk)) {</span>
<span class="co">#&gt;     rws &lt;- which(!chk)</span>
<span class="co">#&gt;     tochk &lt;- unique(typ[!chk])</span>
<span class="co">#&gt;     stop(msg, "\n\tIncorrect Activity Type found: ", paste(tochk, </span>
<span class="co">#&gt;         collapse = ", "), " in row(s) ", paste(rws, collapse = ", "), </span>
<span class="co">#&gt;         call. = FALSE)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug: message(paste(msg, "OK"))</span>
<span class="co">#&gt;  Checking valid Activity Types... OK</span>
<span class="co">#&gt; debug: msg &lt;- "\tChecking Activity Start Date formats..."</span>
<span class="co">#&gt; debug: dts &lt;- resdat$`Activity Start Date`</span>
<span class="co">#&gt; debug: if (anyNA(dts)) {</span>
<span class="co">#&gt;     rws &lt;- which(is.na(dts))</span>
<span class="co">#&gt;     stop(msg, "\n\tCheck date on row(s) ", paste(rws, collapse = ", "), </span>
<span class="co">#&gt;         call. = FALSE)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug: message(paste(msg, "OK"))</span>
<span class="co">#&gt;  Checking Activity Start Date formats... OK</span>
<span class="co">#&gt; debug: msg &lt;- "\tChecking Activity Start Time formats..."</span>
<span class="co">#&gt; debug: tms &lt;- resdat$`Activity Start Time`</span>
<span class="co">#&gt; debug: if (anyNA(tms)) {</span>
<span class="co">#&gt;     rws &lt;- which(is.na(tms))</span>
<span class="co">#&gt;     stop(msg, "\n\tCheck time on row(s) ", paste(rws, collapse = ", "), </span>
<span class="co">#&gt;         call. = FALSE)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug: message(paste(msg, "OK"))</span>
<span class="co">#&gt;  Checking Activity Start Time formats... OK</span>
<span class="co">#&gt; debug: msg &lt;- "\tChecking Relative Depth Category formats..."</span>
<span class="co">#&gt; debug: dps &lt;- resdat$`Relative Depth Category`</span>
<span class="co">#&gt; debug: chk &lt;- dps %in% dpstyp</span>
<span class="co">#&gt; debug: if (any(!chk)) {</span>
<span class="co">#&gt;     rws &lt;- which(!dps %in% dpstyp)</span>
<span class="co">#&gt;     tochk &lt;- unique(dps[!chk])</span>
<span class="co">#&gt;     stop(msg, "\n\tIncorrect Relative Depth Category format found: ", </span>
<span class="co">#&gt;         paste(tochk, collapse = ", "), " on row(s)", paste(rws, </span>
<span class="co">#&gt;             collapse = ", "), call. = FALSE)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug: message(paste(msg, "OK"))</span>
<span class="co">#&gt;  Checking Relative Depth Category formats... OK</span>
<span class="co">#&gt; debug: msg &lt;- "\tChecking Characteristic Name formats..."</span>
<span class="co">#&gt; debug: typ &lt;- resdat$`Characteristic Name`</span>
<span class="co">#&gt; debug: chk &lt;- typ %in% chntyp</span>
<span class="co">#&gt; debug: if (any(!chk)) {</span>
<span class="co">#&gt;     rws &lt;- which(!chk)</span>
<span class="co">#&gt;     tochk &lt;- unique(typ[!chk])</span>
<span class="co">#&gt;     stop(msg, "\n\tIncorrect Characteristic Name found: ", paste(tochk, </span>
<span class="co">#&gt;         collapse = ", "), " in row(s) ", paste(rws, collapse = ", "), </span>
<span class="co">#&gt;         call. = FALSE)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug: message(paste(msg, "OK"))</span>
<span class="co">#&gt;  Checking Characteristic Name formats... OK</span>
<span class="co">#&gt; debug: msg &lt;- "\tChecking Result Values..."</span>
<span class="co">#&gt; debug: typ &lt;- resdat$`Result Value`</span>
<span class="co">#&gt; debug: chk &lt;- paste(paste0("^", restyp, "$"), collapse = "|")</span>
<span class="co">#&gt; debug: chk &lt;- !is.na(suppressWarnings(as.numeric(typ))) | grepl(chk, </span>
<span class="co">#&gt;     typ) | is.na(typ)</span>
<span class="co">#&gt; debug: if (any(!chk)) {</span>
<span class="co">#&gt;     rws &lt;- which(!chk)</span>
<span class="co">#&gt;     tochk &lt;- unique(typ[!chk])</span>
<span class="co">#&gt;     stop(msg, "\n\tIncorrect entries in Result Value found: ", </span>
<span class="co">#&gt;         paste(tochk, collapse = ", "), " in rows ", paste(rws, </span>
<span class="co">#&gt;             collapse = ", "), call. = FALSE)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug: message(paste(msg, "OK"))</span>
<span class="co">#&gt;  Checking Result Values... OK</span>
<span class="co">#&gt; debug: msg &lt;- "\tChecking QC Reference Values..."</span>
<span class="co">#&gt; debug: typ &lt;- resdat$`QC Reference Value`</span>
<span class="co">#&gt; debug: chk &lt;- paste(paste0("^", restyp, "$"), collapse = "|")</span>
<span class="co">#&gt; debug: chk &lt;- !is.na(suppressWarnings(as.numeric(typ))) | grepl(chk, </span>
<span class="co">#&gt;     typ) | is.na(typ)</span>
<span class="co">#&gt; debug: if (any(!chk)) {</span>
<span class="co">#&gt;     rws &lt;- which(!chk)</span>
<span class="co">#&gt;     tochk &lt;- unique(typ[!chk])</span>
<span class="co">#&gt;     stop(msg, "\n\tIncorrect entries in QC Reference Value found: ", </span>
<span class="co">#&gt;         paste(tochk, collapse = ", "), " in rows ", paste(rws, </span>
<span class="co">#&gt;             collapse = ", "), call. = FALSE)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug: message(paste(msg, "OK"))</span>
<span class="co">#&gt;  Checking QC Reference Values... OK</span>
<span class="co">#&gt; debug: message("\nAll checks passed!")</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; All checks passed!</span>
<span class="co">#&gt; debug: return(resdat)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">resdat</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 14</span></span>
<span class="co">#&gt;   `Monitoring Location ID` `Activity Type` `Activity Start Da…` `Activity Star…`</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> HBS-016                  Field Msr/Obs   2021-01-14           09:22           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> HBS-057                  Field Msr/Obs   2021-01-14           10:30           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> HBS-016                  Sample-Routine  2021-01-14           09:22           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> HBS-016                  Sample-Routine  2021-01-14           09:22           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> LND-007                  Field Msr/Obs   2021-01-14           09:50           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> HBS-076                  Field Msr/Obs   2021-01-14           11:58           </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 10 more variables: `Activity Depth/Height Measure` &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   `Activity Depth/Height Unit` &lt;chr&gt;, `Relative Depth Category` &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   `Characteristic Name` &lt;chr&gt;, `Result Value` &lt;chr&gt;, `Result Unit` &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   `Quantitation Limit` &lt;chr&gt;, `QC Reference Value` &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   `Result Measure Qualifier` &lt;chr&gt;, `Result Attribute` &lt;chr&gt;</span></span></code></pre></div>
<p>Several checks are run automatically when the data are imported. These checks are as follows (also viewed from the help file for <code><a href="../reference/check_results.html">check_results()</a></code>:</p>
<ul>
<li>
<strong>Column name spelling</strong>: Should be the following: Monitoring Location ID, Activity Type, Activity Start Date, Activity Start Time, Activity Depth/Height Measure, Activity Depth/Height Unit, Relative Depth Category, Characteristic Name, Result Value, Result Unit, Quantitation Limit, QC Reference Value, Result Measure Qualifier, Result Attribute.</li>
<li>
<strong>Columns present</strong>: All columns from the previous should be present, Result Attribute is optional</li>
<li>
<strong>Activity Type</strong>: Should be one of Field Msr/Obs, Sample-Routine, Quality Control Sample-Field Blank, Quality Control Sample-Lab Blank, Quality Control Sample-Lab Duplicate, Quality Control Sample-Lab Spike</li>
<li>
<strong>Date formats</strong>: Should be mm/dd/yyyy and parsed correctly on import</li>
<li>
<strong>Time formats</strong>: Should be HH:MM and parsed correctly on import</li>
<li>
<strong>Relative Depth Category</strong>: Should be either Surface, Bottom, &lt; 1m / 3.3ft or blank</li>
<li>
<strong>Characteristic Name</strong>: Should be one of air temperature, water temperature, TP, TSS, DO % saturation, DO concentration, flow, gage, pH, sp conductivity, NH3, NO3, orthoP, E coli, or chlorophyll a</li>
<li>
<strong>Result Value</strong>: Should be a numeric value or a text value as AQL or BDL</li>
<li>
<strong>QC Reference Value</strong>: Any entered values should be numeric</li>
</ul>
<p>An informative error is returned if the input data fail any of the checks. The input data should be corrected by hand in the Excel file by altering the appropriate rows or column names indicated in the error.</p>
<p>Here is an example of an error that might be returned for an incorrect data entry (using the <code><a href="../reference/check_results.html">check_results()</a></code> function, which is used inside of <code><a href="../reference/read_results.html">read_results()</a></code>). To remedy the issue, change the entries in row 4 and 135 in the Activity Type column to Sample-Routine and Field Msr/Obs, respectively. This must be done in the original Excel file. Import the data again in R to verify the data are corrected.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">respth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/ExampleResults_final.xlsx'</span>, package <span class="op">=</span> <span class="st">'MassWateR'</span><span class="op">)</span>
<span class="va">resdat</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">respth</span><span class="op">)</span>
<span class="va">chk</span> <span class="op">&lt;-</span> <span class="va">resdat</span>
<span class="va">chk</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'Sample'</span>
<span class="va">chk</span><span class="op">[</span><span class="fl">135</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'Field'</span>
<span class="fu"><a href="../reference/check_results.html">check_results</a></span><span class="op">(</span><span class="va">chk</span><span class="op">)</span>
<span class="co">#&gt; Running checks on results data...</span>
<span class="co">#&gt; Called from: check_results(chk)</span>
<span class="co">#&gt; debug: msg &lt;- "\tChecking column names..."</span>
<span class="co">#&gt; debug: nms &lt;- names(resdat)</span>
<span class="co">#&gt; debug: chk &lt;- nms %in% colnms</span>
<span class="co">#&gt; debug: if (any(!chk)) {</span>
<span class="co">#&gt;     tochk &lt;- nms[!chk]</span>
<span class="co">#&gt;     stop(msg, "\n\tPlease correct the column names or remove: ", </span>
<span class="co">#&gt;         paste(tochk, collapse = ", "), call. = FALSE)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug: message(paste(msg, "OK"))</span>
<span class="co">#&gt;  Checking column names... OK</span>
<span class="co">#&gt; debug: msg &lt;- "\tChecking all required columns are present..."</span>
<span class="co">#&gt; debug: nms &lt;- names(resdat)</span>
<span class="co">#&gt; debug: chk &lt;- colnms[-14] %in% nms</span>
<span class="co">#&gt; debug: if (any(!chk)) {</span>
<span class="co">#&gt;     tochk &lt;- colnms[!chk]</span>
<span class="co">#&gt;     stop(msg, "\n\tMissing the following columns: ", paste(tochk, </span>
<span class="co">#&gt;         collapse = ", "), call. = FALSE)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug: message(paste(msg, "OK"))</span>
<span class="co">#&gt;  Checking all required columns are present... OK</span>
<span class="co">#&gt; debug: msg &lt;- "\tChecking valid Activity Types..."</span>
<span class="co">#&gt; debug: typ &lt;- resdat$`Activity Type`</span>
<span class="co">#&gt; debug: chk &lt;- typ %in% acttyp</span>
<span class="co">#&gt; debug: if (any(!chk)) {</span>
<span class="co">#&gt;     rws &lt;- which(!chk)</span>
<span class="co">#&gt;     tochk &lt;- unique(typ[!chk])</span>
<span class="co">#&gt;     stop(msg, "\n\tIncorrect Activity Type found: ", paste(tochk, </span>
<span class="co">#&gt;         collapse = ", "), " in row(s) ", paste(rws, collapse = ", "), </span>
<span class="co">#&gt;         call. = FALSE)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; debug: rws &lt;- which(!chk)</span>
<span class="co">#&gt; debug: tochk &lt;- unique(typ[!chk])</span>
<span class="co">#&gt; debug: stop(msg, "\n\tIncorrect Activity Type found: ", paste(tochk, </span>
<span class="co">#&gt;     collapse = ", "), " in row(s) ", paste(rws, collapse = ", "), </span>
<span class="co">#&gt;     call. = FALSE)</span>
<span class="co">#&gt; Error:   Checking valid Activity Types...</span>
<span class="co">#&gt;  Incorrect Activity Type found: Sample, Field in row(s) 4, 135</span></code></pre></div>
<p>Data imported with <code><a href="../reference/read_results.html">read_results()</a></code> are also formatted to take care of a few minor issues for downstream analysis. This formatting includes:</p>
<ul>
<li>
<strong>Fix date and time inputs</strong>: Activity Start Date is converted to YYYY-MM-DD as a date object, Activity Start Time is converted to HH:MM as a character to fix artifacts from Excel import.</li>
<li>
<strong>Create duplicate rows for entries in QC Reference Value</strong>: This is done if a value is found in the QC Reference Value column by creating a “new” row with the same location, date, time, etc as the original but with an appropriate quality control entry for the Activity Type.</li>
<li>
<strong>Remove non-text or math symbols from Result Unit</strong>: Values are stripped, e.g., the degree symbols for degrees C</li>
</ul>
</div>
<div class="section level3">
<h3 id="data-quality-objectives">Data quality objectives<a class="anchor" aria-label="anchor" href="#data-quality-objectives"></a>
</h3>
<p>To use the quality control functions in MassWateR, Excel files that describe the data quality objectives for accuracy and completeness must be provided. The system files included with the package, described above, demonstrate the required information and format for these files. They can be imported into R using the <code><a href="../reference/read_dqoaccuracy.html">read_dqoaccuracy()</a></code> and <code><a href="../reference/read_dqocompleteness.html">read_dqocompleteness()</a></code> functions for the accuracy and completeness files, respectively. The <code>pth</code> argument will point to the location of the external files on your computer. As above, the system files included with the package are used for the examples.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import data quality objectives for accuracy</span>
<span class="va">dqoaccpth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/ExampleDQOAccuracy_final.xlsx'</span>, package <span class="op">=</span> <span class="st">'MassWateR'</span><span class="op">)</span>
<span class="va">dqoaccdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_dqoaccuracy.html">read_dqoaccuracy</a></span><span class="op">(</span><span class="va">dqoaccpth</span><span class="op">)</span>
<span class="co">#&gt; Running checks on data quality objectives for accuracy...</span>
<span class="co">#&gt;  Checking column names... OK</span>
<span class="co">#&gt;  Checking all required columns are present... OK</span>
<span class="co">#&gt;  Checking for non-numeric values in MDL, UQL... OK</span>
<span class="co">#&gt;  Checking for text other than &lt;=, &lt;, &gt;=, &gt;, ±, %, AQL, BQL, log, or all... OK</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; All checks passed!</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dqoaccdat</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 10</span></span>
<span class="co">#&gt;   Parameter     uom     MDL   UQL `Value Range` `Field Duplica…` `Lab Duplicate`</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> water temper… C      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> all           &lt;= 10%           &lt;= 10%         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> pH            S.U.   <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> all           ± 0.5            ± 0.5          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> DO concentra… mg/L    0.1    <span style="color: #BB0000;">NA</span> &lt; 4           &lt;= 20%           &lt;= 20%         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> DO concentra… mg/L    0.1    <span style="color: #BB0000;">NA</span> &gt;= 4          &lt;= 10%           &lt;= 10%         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> sp conductiv… µS/cm   1      <span style="color: #BB0000;">NA</span> &lt; 250         &lt;= 30%           &lt;= 20%         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> sp conductiv… µS/cm   1      <span style="color: #BB0000;">NA</span> &gt;= 250        &lt;= 20%           &lt;= 10%         </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 3 more variables: `Field Blank` &lt;chr&gt;, `Lab Blank` &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   `Spike/Check Accuracy` &lt;chr&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import data quality objectives for completeness</span>
<span class="va">dqocompth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/ExampleDQOCompleteness_final.xlsx'</span>, package <span class="op">=</span> <span class="st">'MassWateR'</span><span class="op">)</span>
<span class="va">dqocomdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_dqocompleteness.html">read_dqocompleteness</a></span><span class="op">(</span><span class="va">dqocompth</span><span class="op">)</span>
<span class="co">#&gt; Running checks on data quality objectives for completeness...</span>
<span class="co">#&gt;  Checking column names... OK</span>
<span class="co">#&gt;  Checking all required columns are present... OK</span>
<span class="co">#&gt;  Checking for non-numeric values... OK</span>
<span class="co">#&gt;  Checking for values outside of 0 and 100... OK</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; All checks passed!</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dqocomdat</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span>
<span class="co">#&gt;   Parameter         `Field Duplicate` `Lab Duplicate` `Field Blank` `Lab Blank`</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> water temperature                10              10            <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> pH                               10              10            <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> DO concentration                 10              10            <span style="color: #BB0000;">NA</span>          10</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> sp conductivity                  10              10            <span style="color: #BB0000;">NA</span>          10</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> TSS                              10               5            10           5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> TP                               10               5            10           5</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 2 more variables: `Spike/Check Accuracy` &lt;dbl&gt;, `% Completeness` &lt;dbl&gt;</span></span></code></pre></div>
<p>Both the <code><a href="../reference/read_dqoaccuracy.html">read_dqoaccuracy()</a></code> and <code><a href="../reference/read_dqocompleteness.html">read_dqocompleteness()</a></code> functions will run a series of checks to ensure the imported data are formatted correctly. The <code><a href="../reference/check_dqoaccuracy.html">check_dqoaccuracy()</a></code> and <code><a href="../reference/check_dqocompleteness.html">check_dqocompleteness()</a></code> functions run these checks when the <code><a href="../reference/read_dqoaccuracy.html">read_dqoaccuracy()</a></code> and <code><a href="../reference/read_dqocompleteness.html">read_dqocompleteness()</a></code> functions are executed, respectively. The checks for each are as follows.</p>
<p>Checks for accuracy:</p>
<ul>
<li>
<strong>Column name spelling</strong>: Should be the following: Parameter, uom, MDL, UQL, Value Range, Field Duplicate, Lab Duplicate, Field Blank, Lab Blank, Spike/Check Accuracy</li>
<li>
<strong>Columns present</strong>: All columns from the previous check should be present</li>
<li>
<strong>Non-numeric values in MDL, UQL</strong>: Values entered in columns MDL and UQL should be numeric</li>
<li>
<strong>Unrecognized characters</strong>: Fields describing accuracy checks should not include symbols or text other than &lt;=, &lt;, &gt;=, &gt;, ±, %, BDL, AQL, log, or all</li>
</ul>
<p>Checks for completeness:</p>
<ul>
<li>
<strong>Column name spelling</strong>: Should be the following: Parameter, Field Duplicate, Lab Duplicate, Field Blank, Lab Blank, Spike/Check Accuracy, % Completeness</li>
<li>
<strong>Columns present</strong>: All columns from the previous check should be present</li>
<li>
<strong>Non-numeric values</strong>: Values entered in columns other than the first should be numeric</li>
<li>
<strong>Values outside of 0 - 100</strong>: Values entered in columns other than the first should not be outside of 0 and 100</li>
</ul>
</div>
<div class="section level3">
<h3 id="site-metadata">Site metadata<a class="anchor" aria-label="anchor" href="#site-metadata"></a>
</h3>
<p>An Excel file for site metadata that describes spatial location and any other grouping factors for the sites in the results file can be imported using <code><a href="../reference/read_sites.html">read_sites()</a></code>. The system file included with the package, described above, demonstrates the required information and format for the file. The <code>pth</code> argument will point to the location of the external file on your computer. As above, the system file included with the package is used for the example.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import site metadata</span>
<span class="va">sitpth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/ExampleSites_final.xlsx'</span>, package <span class="op">=</span> <span class="st">'MassWateR'</span><span class="op">)</span>
<span class="va">sitdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_sites.html">read_sites</a></span><span class="op">(</span><span class="va">sitpth</span><span class="op">)</span>
<span class="co">#&gt; Running checks on site metadata...</span>
<span class="co">#&gt;  Checking column names... OK</span>
<span class="co">#&gt;  Checking all required columns are present... OK</span>
<span class="co">#&gt;  Checking for missing latitude or longitude values... OK</span>
<span class="co">#&gt;  Checking for non-numeric values in latitude... OK</span>
<span class="co">#&gt;  Checking for non-numeric values in longitude... OK</span>
<span class="co">#&gt;  Checking for positive values in longitude... OK</span>
<span class="co">#&gt;  Checking for missing entries for Monitoring Location ID... OK</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; All checks passed!</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sitdat</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span>
<span class="co">#&gt;   `Monitoring Location ID` `Monitoring Locat…` `Monitoring Lo…` `Monitoring Lo…`</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ABT-010                  477 Lowell Rd, Con…             42.5            -<span style="color: #BB0000;">71.4</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ABT-026                  Rte 2, Concord                  42.5            -<span style="color: #BB0000;">71.4</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ABT-033                  Rte 62, W Concord               42.5            -<span style="color: #BB0000;">71.4</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ABT-044                  Rte 62 (Damonmill)…             42.5            -<span style="color: #BB0000;">71.4</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ABT-047                  Damonmill dam                   42.5            -<span style="color: #BB0000;">71.4</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ABT-062                  Rte 62, Acton                   42.4            -<span style="color: #BB0000;">71.4</span></span>
<span class="co">#&gt; <span style="color: #949494;"># … with 1 more variable: `Location Group` &lt;chr&gt;</span></span></code></pre></div>
<p>The <code><a href="../reference/read_sites.html">read_sites()</a></code> functions runs several checks on the file using the <code><a href="../reference/check_sites.html">check_sites()</a></code> function. Most of the checks are to ensure the latitude and longitude data are present and properly formatted. It is assumed that latitude and longitude data are entered in decimal degrees. The projection can be entered in other functions used in exploratory analysis. Details on the checks are as follows:</p>
<ul>
<li>
<strong>Column name spelling</strong>: Should be the following: Monitoring Location ID, Monitoring Location Name, Monitoring Location Latitude, Monitoring Location Longitude, Location Group</li>
<li>
<strong>Columns present</strong>: All columns from the previous check should be present</li>
<li>
<strong>Missing longitude or latitude</strong>: No missing entries in Monitoring Location Latitude or Monitoring Location Longitude</li>
<li>
<strong>Non-numeric latitude values</strong>: Values entered in Monitoring Location Latitude must be numeric</li>
<li>
<strong>Non-numeric longitude values</strong>: Values entered in Monitoring Location Longitude must be numeric</li>
<li>
<strong>Positive longitude values</strong>: Values in Monitoring Location Longitude must be negative</li>
<li>
<strong>Missing Location ID</strong>: No missing entries for Monitoring Location ID</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marcus Beck, Jill Carr, Ben Wetherill, Pam DiBona.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
