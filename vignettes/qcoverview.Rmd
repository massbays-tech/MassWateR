---
title: "MassWateR quality control functions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{MassWateR quality control functions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  warning = F, 
  message = F
)
```

The quality control functions in MassWateR can be used once the required data are successfully imported into R (see the [previous vignette](https://massbays-tech.github.io/MassWateR/articles/datainput.html) for an overview).  The required data includes the results data file that describe the monitoring data and the data quality objective files for completeness and accuracy.  The example data files included with the package are imported here to demonstrate how to use the quality control functions:

```{r, message = T}
library(MassWateR)

# import results data
respth <- system.file('extdata/ExampleResults_final.xlsx', package = 'MassWateR')
resdat <- read_results(respth)

# import data quality objectives for accuracy
dqoaccpth <- system.file('extdata/ExampleDQOAccuracy_final.xlsx', package = 'MassWateR')
dqoaccdat <- read_dqoaccuracy(dqoaccpth)

# import data quality objectives for completeness
dqocompth <- system.file('extdata/ExampleDQOCompleteness_final.xlsx', package = 'MassWateR')
dqocomdat <- read_dqocompleteness(dqocompth)
```

## Quality control for accuracy

## Quality control for completeness

The quality control checks for completeness are used to verify an appropriate number of quality control samples have been collected or analyzed for each parameter.  These are checks on the quantity of samples and not the values, as for the accuracy checks.  

The completeness checks require results data (as in `resdat` above) and a data quality objectives file for completeness (as in `dqocomdat`).  The core function that assesses completeness is `qc_completeness()`.  This function creates the raw summaries of completeness from the input data.  Output from this function is used to create the formatted tables for reporting.  Typically, `qc_completeness()` is not used by itself because it is used internally in other functions to create the tables.  It is explained here to demonstrate the raw summaries that can be obtained, if desired. 

The `qc_completeness()` function can be used with inputs as paths to the relevant files or as data frames returned by `read_results()` and `read_dqocompleteness()`.  For the former, the full suite of data checks can be evaluated with `runkchk = T` (default) or suppressed with `runchk = F`, as explained in the [data inputs and checks vignette](https://massbays-tech.github.io/MassWateR/articles/datainput.html).  In the latter case, downstream analyses may not work if data are formatted incorrectly.  Also note that completeness is only evaluated on parameters in the `Parameter` column in the data quality objectives completeness file.  A warning is returned if there are parameters in that column that are not found in the results file.  This warning can be suppressed by setting `warn = FALSE` in `qc_completeness()`.

Below, the `qc_completeness()` function is executed with the data frames for the results and quality objectives file for completeness.  Note that a warning message is returned indicating that the parameter `Chloride` was found in the data quality objectives file, but was not found in the results data.  Completeness checks are done only on parameters that are shared between the two.  

```{r, warning = T}
qc_completeness(res = resdat, dqocom = dqocomdat)
```

The output shows the completeness checks from the combined files in long format.  Each row applies to a specific completeness check for a parameter. The total observations (`obs`) for each parameter are also shown, which is repeated for a parameter across the rows to calculate percentages.  The `check` column shows the relevant activity type that is assessed for completeness, the `count` columns shows the number of observations that apply to the check, the `standard` shows the relevant percentage required for quality control check from the quality control objectives file, the `percent` column shows the calculated percent taken from the input data, and the `met` column shows if the standard was met by comparing if `percent` is greater than or equal to `standard`.
