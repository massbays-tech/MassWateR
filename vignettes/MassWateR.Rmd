---
title: "MassWateR quick start"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{MassWateR data input and checks}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE, message = F, warning = F}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  warning = T, 
  message = F, 
  fig.align = "center"
)

library(dplyr)
```

## Overview

The MassWateR R package is developed for surface water monitoring data collected by watershed associations and citizen science groups in Massachusetts. The package is created in collaboration with the [Massachusetts Bays National Estuary Partnership](https://www.mass.gov/orgs/massachusetts-bays-national-estuary-partnership) with funding from an EPA Exchange Network Grant.

The objective of the package is to automate and facilitate quality control and exploratory analysis of data intended for upload to the EPA [Water Quality Exchange](https://www.epa.gov/waterdata/water-quality-data) (WQX). The functions provide a streamlined and repeatable means of 1) screening data for quality control, 2) interpreting data, and 3) creating graphics for analysis and reports to stakeholders. Additional formatting tools are also available to facilitate data upload to WQX. The functions are organized around these topics, shown below.

```{r workflow, out.width = '100%', echo = F, fig.cap = 'Functions in MassWateR are organized around these topics.'}
knitr::include_graphics("workflow.PNG")
```

## Package installation

Install the package as follows:

```{r, eval = F}
# Enable universe(s) by massbays-tech
options(repos = c(
  massbaystech = "https://massbays-tech.r-universe.dev",
  CRAN = "https://cloud.r-project.org"))

# Install the package
install.packages("MassWateR")
```

Windows PC users may encounter the following warning when installing MassWateR.

```r
WARNING: Rtools is required to build R packages but is not currently installed. Please download and install the appropriate version of Rtools before proceeding: https://cran.rstudio.com/bin/windows/Rtools/
```

This warning can be ignored.  If desired, RTools can be obtained following the instructions [here](https://cran.rstudio.com/bin/windows/Rtools/).

Load the package in an R session after installation:

```{r}
library(MassWateR)
```

## Data inputs

Please view the [data inputs and checks](https://massbays-tech.github.io/MassWateR/articles/inputs.html) vignette for a complete description of the data requirements for MassWateR.

Four types of data are used with the MassWateR package: surface water quality results, data quality objectives for accuracy, frequency, and completeness, site metadata, and wqx metadata.

The example files included with the package are imported below for demonstration in this vignette. Templates and instructions for each of the types of input data are available for download in the [Resources tab](/MassWateR/RESOURCES.md).  A series of checks are run on each file on import.

```{r, warning = F}
# results data
respth <- system.file("extdata/ExampleResults.xlsx", package = "MassWateR")
resdat <- readMWRresults(respth)

# import results data
respth <- system.file("extdata/ExampleResults.xlsx", package = "MassWateR")
resdat <- readMWRresults(respth)

# import data quality objectives for accuracy
accpth <- system.file("extdata/ExampleDQOAccuracy.xlsx", package = "MassWateR")
accdat <- readMWRacc(accpth)

# import data quality objectives for frequency and completeness
frecompth <- system.file("extdata/ExampleDQOFrequencyCompleteness.xlsx", package = "MassWateR")
frecomdat <- readMWRfrecom(frecompth)

# import site metadata
sitpth <- system.file("extdata/ExampleSites.xlsx", package = "MassWateR")
sitdat <- readMWRsites(sitpth)

# import wqx metadata
wqxpth <- system.file("extdata/ExampleWQX.xlsx", package = "MassWateR")
wqxdat <- readMWRwqx(wqxpth)
```

After data are imported, a single data object can be created that can be used with all MassWateR functions. 

```{r}
# a list of input data frames
fsetls <- list(
  res = resdat, 
  acc = accdat,
  frecom = frecomdat,
  sit = sitdat, 
  wqx = wqxdat
)
```

## Quality control functions

Please view the [quality control functions](https://massbays-tech.github.io/MassWateR/articles/qcoverview.html) vignette for a complete description of the quality control functions in MassWateR.

The `qcMWRreview()` function compiles a review report as a Word document for all quality control checks included in the MassWateR package.  The report shows several tables, including the data quality objectives files for accuracy, frequency, and completeness, summary results for all accuracy checks, summary results for all frequency checks, summary results for all completeness checks, and individual results for all accuracy checks.

The report can be created as follows.  Once the function is done running, a message indicating success and where the file is located is returned.  The Word file can be further edited by hand as needed.  

```{r, message = T}
qcMWRreview(fset = fsetls, warn = FALSE)
```

## Outlier checks

Please view the [outlier checks](https://massbays-tech.github.io/MassWateR/articles/inputs.html) vignette for a complete description of the outlier check functions in MassWateR.

The `anlzMWRoutlier()` function can identify outliers for a selected parameter using boxplots, with the outliers labelled accordingly.

```{r, fig.height = 4, fig.width = 8}
anlzMWRoutlier(fset = fsetls, param = "DO", acc = accdat, group = "month")
```

Outlier plots for all parameters in the results data file can be created using the `anlzMWRoutlierall()` function. This can be used to create a word document with all plots embedded in the file or as separate png images saved to a specified directory.  

```{r, message = T}
anlzMWRoutlierall(fset = fsetls, group = 'month', format = 'word')
```

## Analyses

Please view the [analyses](https://massbays-tech.github.io/MassWateR/articles/analysis.html) vignette for a complete description of the analysis functions in MassWateR.

## Modifying plots

Please view the [modifying plots](https://massbays-tech.github.io/MassWateR/articles/modifying.html) vignette for a complete description of how plots created in MassWateR can be modified by hand.

## Water Quality Exchange output

Please view the [Water Quality Exchange output](https://massbays-tech.github.io/MassWateR/articles/inputs.html) vignette for a complete description of creating output for WQX upload with MassWateR.

